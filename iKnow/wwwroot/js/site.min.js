var appController=function(){var n=function(){var n=$(this),t=n.attr("data-delete-message");return confirm(t)},t=function(){$(this).scrollTop()>500?$(".back-top-container").fadeIn():$(".back-top-container").fadeOut()},i=function(){$("html, body").animate({scrollTop:0},300)},r=function(){var n=this.scrollHeight;$(this).css("height",n+"px")},u=function(){var n=$(".search-form .search").val();return n?!0:!1},f=function(){ModalController.init();HeaderController.init();WarningErrorController.init();$(window).scroll(t);$(".back-top").on("click",i);$(".search-form").on("submit",u)};return{init:f,deleteEntity:n,textareaAutoGrow:r}}(),AnswerController=function(){var n=function(n){$(n.currentTarget).find(".blue-link-color").toggleClass("underline")},t=function(n){var t=$(n.currentTarget);t.addClass("hide");t.next().removeClass("hide")},i=function(n){var f=$(n.currentTarget),t=f.closest(".expanded-answer-container"),e=t.siblings(".question-author"),i=$(window),r=t.closest(".question-answer-inner"),o=r.height()-i.scrollTop(),u;t.addClass("hide");t.prev().removeClass("hide");i.scrollTop()>e.offset().top&&(u=r.height()-o,i.scrollTop(u))},r=function(){var r=$(".question-answer-container, .activity-whole-panel");r.on("mouseenter",".short-answer-container",n);r.on("mouseleave",".short-answer-container",n);r.on("click",".short-answer-container",t);r.on("click",".collapse-answer",i);AnswerFooterController.init()};return{init:r}}(),AnswerFooterController=function(n){var t=function(t,i,r){t.html("");t.next(".comment-loading").removeClass("hide");var u=function(n){t.html(n);t.next(".comment-loading").addClass("hide")};n.getComments(u,i,r)},u=function(){var n=$(this),r=n.attr("data-page-number"),i=n.closest(".comment-list"),u=i.closest(".answer-comment"),f=u.attr("data-answer-id");t(i,f,+r)},i=function(n){return n>0?`${n} Comment(s)`:"Add Comment"},f=function(){var u=$(this).parent(".answer-footer-bar"),r=u.find(".comment-button-text"),n=u.next(".answer-comment"),f,e,o;n.hasClass("hide")?(f=n.attr("data-answer-id"),e=n.find(".comment-list"),t(e,f,1),n.removeClass("hide"),r.html("Hide Comment")):(n.addClass("hide"),o=r.attr("data-total-count"),r.html(i(o)))},e=function(n){var f=n.find(".comment-header strong"),r=n.closest(".answer-footer").find(".comment-button-text"),t=r.attr("data-total-count"),u;t=+t+1;r.attr("data-total-count",t);u=i(t);f.html(u);r.html(u)},o=function(){var i=$(this),r=i.attr("data-answer-id"),u=i.prev(),f=u.val().trim(),o;f&&(o=function(n){u.val("");var f=i.closest(".comment-container"),o=f.find(".comment-list");e(f);t(o,r,n)},n.postComment(o,r,f))},r=function(n,t){return n>0?t?`Liked ${n}`:`Like ${n}`:"Like"},s=function(){var t=$(this),s=t.parent(".answer-footer-bar"),u=s.attr("data-answer-id"),i=t.attr("data-like-count"),f=t.find(".like-button-text"),e,o;t.hasClass("answer-liked")?(e=function(){t.removeClass("answer-liked");i=+i-1;f.html(r(i,!1));t.attr("data-like-count",i)},n.unlikeAnswer(e,u)):(o=function(){t.addClass("answer-liked");i=+i+1;f.html(r(i,!0));t.attr("data-like-count",i)},n.likeAnswer(o,u))},h=function(){var n=$(".question-answer-container, .activity-whole-panel");n.on("click",".answer-footer-bar .comment-button",f);n.on("input",".answer-comment textarea",appController.textareaAutoGrow);n.on("click",".answer-comment .write-comment .btn",o);n.on("click",".answer-comment .comment-pagination-container .comment-page",u);n.on("click",".answer-footer-bar .like-button",s)};return{init:h}}(AnswerFooterService),HeaderController=function(n,t){var i=function(){var t=$(".modal-container");if(iknow.isUserAuthorized!==!0){WarningErrorController.showWarning("Please log in before you add question");return}if(t.hasClass("new-question-form-loaded")){ModalController.open();return}n.getForm(function(n){ModalController.toggleModalCommonCallback(n);t.addClass("new-question-form-loaded")})},r=function(){event.stopPropagation();$(".user-profile-dropdown").show()},u=function(n){var i=$(".search").val();if(i===""||n.keyCode===27){$(".search-result-container").html("");return}t.search(i,function(n){n&&$(".search-result-container").html(n)})},f=function(n){$(n.target).parents(".search-container").length>0||$(".search-result-container").html("")},e=function(){$(".user-profile-dropdown").hide();f(event)},o=function(){$(".add-question-button").on("click",i);$(".user-profile-inner").on("click",r);$(".search").on("keyup",u);$(document).on("click",e)};return{init:o}}(QuestionService,SearchService),LoadMoreController=function(n){var u,t,f,i,e,r,o=function(n){n?(f.append(n),t.show(),t.next().hide(),i++):t.parent().addClass("end-of-list");r&&r()},s=function(){t=$(this);t.hide();t.next().show();n.loadMore(u,i,o,e)},h=function(n,t,o){u=n;f=$(".load-more-list");i=0;e=t;r=o;$(".to-load").on("click",s)};return{init:h}}(LoadMoreService),ModalController=function(){var t=function(){if(event.target===event.currentTarget){var n=$(".modal-container");if(n.hasClass("open")){n.removeClass("open");$(document.body).removeClass("modal-open");return}}},n=function(){$(".modal-container").addClass("open");$(document.body).addClass("modal-open")},i=function(){$(".modal-container").removeClass("open");$(document.body).removeClass("modal-open")},r=function(t){if(t){var i=$(".modal-container");i.html(t);n();$(".topic-select").chosen({width:"100%",max_selected_options:5})}},u=function(){$(".modal-container").on("click",t);$(".modal-container").on("click",".js-button-delete",appController.deleteEntity);$(".modal-container").on("input","textarea",appController.textareaAutoGrow);$(".modal-container").on("click",".error li",WarningErrorController.hideError)};return{init:u,toggleModalCommonCallback:r,open:n,close:i}}(),PhotoUploadController=function(n,t){var i,r=function(n){var f,o,h,e,s,c,l,u=160,a,y=i.attr("data-user-id");$(".modal-container").removeClass("new-question-form-loaded");var r={},k=function(){e=(f.width-u)/2;s=(f.height-u)/2;c=u+e;l=u+s;r.currentX||(r.currentX=e);r.currentY||(r.currentY=s);r.currentWidth||(r.currentWidth=u);r.currentHeight||(r.currentHeight=u);a=$(".photo-resizer input").val()},d=function(){o.clearRect(0,0,f.width,f.height);o.fillStyle="#f6f6f6";o.fillRect(0,0,f.width,f.height)},g=function(n,t){var c=h.width*a,l=h.height*a,f=r.currentX-(c-r.currentWidth)/2+(n?n:0),i;f>e&&(f=e);f<e-(c-u)&&(f=e-(c-u));i=r.currentY-(l-r.currentHeight)/2+(t?t:0);i>s&&(i=e);i<s-(l-u)&&(i=s-(l-u));o.drawImage(h,f,i,c,l);r.currentX=f;r.currentY=i;r.currentWidth=c;r.currentHeight=l},nt=function(){o.globalAlpha=.5;o.fillRect(e,0,u,s);o.fillRect(0,0,e,f.height);o.fillRect(e,l,u,f.height-l);o.fillRect(c,0,f.width-c,f.height);o.globalAlpha=1},v=function(n,t){k();d();g(n,t);nt()},p=function(n){var t={},i;n.preventDefault();n.stopPropagation();i=n.originalEvent.touches;t.x=(n.clientX||n.pageX||i[0].clientX)+$(window).scrollLeft();t.y=(n.clientY||n.pageY||i[0].clientY)+$(window).scrollTop();v(t.x-r.originalX,t.y-r.originalY);r.originalX=t.x;r.originalY=t.y},w=function(n){n.preventDefault();n.stopPropagation();r.originalX=(n.clientX||n.pageX||touches[0].clientX)+$(window).scrollLeft();r.originalY=(n.clientY||n.pageY||touches[0].clientY)+$(window).scrollTop();$(document).on("mousemove touchmove",p);$(document).on("mouseup touchend",b)},b=function(n){n.preventDefault();$(document).off("mouseup touchend",b);$(document).off("mousemove touchmove",p)},tt=function(n){$("#photo-canvas").off("mousedown touchstart",w);f=$("#photo-canvas")[0];o=f.getContext("2d");h=new Image;h.src=n.currentTarget.result;h.onload=function(){v()};var t=$(".photo-resizer input");t.on("input change",function(){v()});t.val(1);$("#photo-canvas").on("mousedown touchstart",w)},it=function(){var n=document.createElement("canvas"),r;n.width=u;n.height=u;n.getContext("2d").drawImage(f,e,s,u,u,0,0,u,u);r=n.toDataURL("image/png");t.savePhoto(y,r,function(){i.attr("src",r);$(".profile-photo").attr("src",r);ModalController.close()})},rt=function(t){if(n.currentTarget.files&&n.currentTarget.files[0]){ModalController.toggleModalCommonCallback(t);var i=new FileReader;i.onload=tt;i.readAsDataURL(n.currentTarget.files[0]);$(".save-photo").click(it)}};t.getForm(rt,y)},u=function(){$(this).val("")},f=function(n,t){i=$(t);$(n).on("change",r);$(n).on("click",u)};return{init:f}}(QuestionService,PhotoUploadService),QuestionController=function(n){var t,e=function(){var n=$(".ql-editor");return n.text().trim().length===0&&n.find("img").length===0?(WarningErrorController.showWarning("Content can not be empty."),!1):($(".ql-editor").html()&&($(this).get(0).elements.AnswerPanelContent.value=$(".ql-editor").html()),!0)},o=function(){return new Quill(".rich-editor-inner",{placeholder:"Write your answer here...",modules:{toolbar:[["bold","italic"],[{header:2},"blockquote"],[{list:"ordered"},{list:"bullet"}],["link","image"],["clean"]]},theme:"snow",formats:["bold","italic","link","header","list","blockquote","image","indent"],clipboard:{matchVisual:!1},bounds:".rich-editor"})},s=function(n){var t,i;n.currentTarget.scrollHeight!==n.currentTarget.offsetHeight&&(t=0,n.originalEvent.wheelDelta?t=n.originalEvent.wheelDelta:n.originalEvent.detail&&(t=-n.originalEvent.detail),i=$(n.currentTarget).scrollTop(),(t<0&&i>n.currentTarget.scrollHeight-n.currentTarget.offsetHeight-5||t>0&&i<5)&&n.preventDefault())},h=function(){$(".ql-editor").on("mousewheel DOMMouseScroll",function(n){s(n)});$(".full-screen").on("click",function(){$("body").toggleClass("modal-open editor-full-screen")})},c=function(){$("html, body").scrollTop($(".main-content-container").offset().top-100);$(".ql-editor").get(0).focus()},i=function(n){if($(".add-answer-panel").hasClass("hide")){if(iknow.isUserAuthorized!==!0){WarningErrorController.showWarning("Please log in before you write question");return}if(n===!0){var t=$(event.currentTarget).siblings(".answer-panel-content-inner").html();$(".rich-editor-inner").html(t)}o();h();$(".add-answer-panel.hide").slideDown(100).removeClass("hide")}c()},l=function(){var i=$(event.currentTarget).attr("data-question-id"),t;$(".modal-container").removeClass("new-question-form-loaded");t=function(n){ModalController.toggleModalCommonCallback(n);var t=$(".add-question-description textarea"),i=$(".add-question-description textarea").get(0).scrollHeight;t.css("height",i+"px")};n.getForm(t,i)},a=function(){var t=$(event.currentTarget).attr("data-question-id");$(".modal-container").removeClass("new-question-form-loaded");n.getTopic(ModalController.toggleModalCommonCallback,t)},v=function(){var n=$(".load-more-list"),t=n.attr("data-answer-count");n.find(".answer-panel").length===t&&$(".load-more").addClass("end-of-list")},r=function(){event.stopPropagation();var n=$(this).closest(".answer-panel-content-container"),t;n.hasClass("is-collapsed")||(t=n.height()-$(window).scrollTop());n.toggleClass("is-collapsed");t&&$(window).scrollTop(n.height()-t)},u=function(n){var t=n.closest(".answer-panel-content-container");t.outerHeight()<800?t.find(".collapse-answer").addClass("hide"):t.find(".collapse-answer").removeClass("hide")},y=function(n){var t=n.find("img");if(u(n),t.length>0)t.on("load",function(){u(n)})},p=function(){var n;n=t?t.nextAll().find(".answer-panel-content"):$(".whole-panel, .current-answer-panel").find(".answer-panel-content");$.each(n,function(i){y($(this));i===n.length-1&&(t=$(this).closest(".answer-panel"))})},f=function(){v();p()},w=function(){$(".more-answer-panel .answer-panel-content-container").addClass("is-collapsed")},b=function(){$(".add-answer-panel").on("submit","form",e);$(".add-answer-panel").on("click",".js-button-delete",appController.deleteEntity);$(".write-answer").on("click",i);$(".edit-answer").on("click",function(){i(!0)});$(".question-header-panel .js-edit-question").on("click",l);$(".question-header-panel .js-edit-topic").on("click",a);$(".whole-panel, .answer-panel-container").on("click",".collapse-answer",r);$(".whole-panel, .answer-panel-container").on("click",".answer-panel-content-container.is-collapsed",r);AnswerFooterController.init();f()};return{init:b,loadAnswerCallBack:f,collapseAnswersInMoreAnswersPanel:w}}(QuestionService),RegisterController=function(n){var t=function(){if($(".modal-container").hasClass("register-form-loaded")){ModalController.open();return}var t=$(event.currentTarget).attr("data-return-url")?"?returnUrl="+$(event.currentTarget).attr("data-return-url"):"";n.getRegisterForm(function(n){ModalController.toggleModalCommonCallback(n);$(".modal-container").addClass("register-form-loaded")},t)},i=function(){$(".register-container a").on("click",t)};return{init:i}}(RegisterService),TopicController=function(n){var t,u=function(){var t=$(this),i;t.hasClass("active")||(i=t.attr("data-topic-id"),n.selectTopic(i,function(n){n&&(t.siblings().removeClass("active"),t.addClass("active"),$(".topic-body").html(n))}))},f=function(){t=$(this);var u=t.attr("data-topic-id");t.hasClass("btn-grey")?n.unfollow(u,i,r):n.follow(u,i,r)},i=function(){var n=t.hasClass("btn-grey")?"Follow":"Following";t.toggleClass("btn-grey").text(n)},r=function(){var n=t.hasClass("btn-grey")?"unfollow":"follow";console.error("Something went wrong with TopicService "+n+".")},e=function(){$(".topic-list").on("click","li",u);$(".js-topic-toggle").on("click",f)};return{init:e}}(TopicService),TopicPhotoUploadController=function(){var n,t=function(){if(event.currentTarget.files&&event.currentTarget.files[0]){var t=new FileReader;t.onload=function(t){n.attr("src",t.currentTarget.result)};t.readAsDataURL(event.currentTarget.files[0])}},i=function(i,r){n=$(r);$(i).on("change",t)};return{init:i}}(),WarningErrorController=function(){var n=function(){$(this).hide()},i=function(){$(".warning").removeClass("warning-display severe-warning");$(".error").removeClass("validation-summary-errors")},t=function(n,t){var r=$(".warning");i();r.html("");$("<div>").html(n).appendTo(r);t&&r.addClass("severe-warning");setTimeout(function(){r.addClass("warning-display")},50)},r=function(){iknow.pageError&&t(iknow.pageError,!0);iknow.statusMessage&&t(iknow.statusMessage)},u=function(){$(".error").on("click","li",n);$(".warning").on("click","div",n);r()};return{init:u,hideError:n,showWarning:t,cleanUpErrorAndWarning:i}}(),AnswerFooterService=function(){var n=function(n,t,i){$.ajax({url:"/question/getcomments/"+t+"/"+i,dataType:"html",success:n,fail:function(){console.error("Something went wrong with AnswerFooterService getComments.")}})},t=function(n,t,i){$.ajax({url:"/answerFooter/postComment",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({answerId:t,comment:i}),success:n,fail:function(){console.error("Something went wrong with AnswerFooterService postComment.")}})},i=function(n,t){$.ajax({url:"/answerFooter/likeAnswer/"+t,type:"POST",contentType:"application/json; charset=utf-8",success:n,fail:function(){console.error("Something went wrong with AnswerFooterService likeAnswer.")}})},r=function(n,t){$.ajax({url:"/answerFooter/unlikeAnswer/"+t,type:"DELETE",contentType:"application/json; charset=utf-8",success:n,fail:function(){console.error("Something went wrong with AnswerFooterService unlikeAnswer.")}})};return{getComments:n,postComment:t,likeAnswer:i,unlikeAnswer:r}}(),LoadMoreService=function(){var n=function(n,t,i,r){$.ajax({url:"/"+n+"/loadmore/"+t+(r?r:""),dataType:"html",success:i,fail:function(){console.error("Something went wrong with LoadMoreService loadMore.")}})};return{loadMore:n}}(),PhotoUploadService=function(){var n=function(n,t){$.ajax({url:"/account/editProfilePhoto/"+t,dataType:"html",success:n,fail:function(){console.error("Something went wrong with PhotoUploadService getForm.")}})},t=function(n,t,i){$.ajax({url:"/api/account",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({userId:n,dataURL:t}),success:i,fail:function(){console.error("Something went wrong with PhotoUploadService savePhoto.")}})};return{getForm:n,savePhoto:t}}(),QuestionService=function(){var n=function(n,t){$.ajax({url:"/question/getform"+(t?"/"+t:""),dataType:"html",success:n,fail:function(){console.error("Something went wrong with QuestionService getForm.")}})},t=function(n,t){$.ajax({url:"/question/gettopic/"+t,dataType:"html",success:n,fail:function(){console.error("Something went wrong with QuestionService getForm.")}})};return{getForm:n,getTopic:t}}(),RegisterService=function(){var n=function(n,t){$.ajax({url:"/account/register"+t,dataType:"html",success:n,fail:function(){console.error("Something went wrong with RegisterService getRegisterForm.")}})};return{getRegisterForm:n}}(),SearchService=function(){var n=function(n,t){$.ajax({url:"/search/getresult?input="+n,dataType:"html",success:t,fail:function(){console.error("Something went wrong with SearchService search.")}})};return{search:n}}(),TopicService=function(){var n=function(n,t){$.ajax({url:"/topic/about/"+n,dataType:"html",success:t,fail:function(){console.error("Something went wrong with TopicService selectTopic.")}})},t=function(n,t,i){$.post("/api/topicfollowing",{"":n}).done(t).fail(i)},i=function(n,t,i){$.ajax({url:"/api/topicfollowing/"+n,method:"DELETE"}).done(t).fail(i)};return{selectTopic:n,follow:t,unfollow:i}}(),appController=function(){var n=function(){var n=$(this),t=n.attr("data-delete-message");return confirm(t)},t=function(){$(this).scrollTop()>500?$(".back-top-container").fadeIn():$(".back-top-container").fadeOut()},i=function(){$("html, body").animate({scrollTop:0},300)},r=function(){var n=this.scrollHeight;$(this).css("height",n+"px")},u=function(){var n=$(".search-form .search").val();return n?!0:!1},f=function(){ModalController.init();HeaderController.init();WarningErrorController.init();$(window).scroll(t);$(".back-top").on("click",i);$(".search-form").on("submit",u)};return{init:f,deleteEntity:n,textareaAutoGrow:r}}(),AnswerController=function(){var n=function(n){$(n.currentTarget).find(".blue-link-color").toggleClass("underline")},t=function(n){var t=$(n.currentTarget);t.addClass("hide");t.next().removeClass("hide")},i=function(n){var f=$(n.currentTarget),t=f.closest(".expanded-answer-container"),e=t.siblings(".question-author"),i=$(window),r=t.closest(".question-answer-inner"),o=r.height()-i.scrollTop(),u;t.addClass("hide");t.prev().removeClass("hide");i.scrollTop()>e.offset().top&&(u=r.height()-o,i.scrollTop(u))},r=function(){var r=$(".question-answer-container, .activity-whole-panel");r.on("mouseenter",".short-answer-container",n);r.on("mouseleave",".short-answer-container",n);r.on("click",".short-answer-container",t);r.on("click",".collapse-answer",i);AnswerFooterController.init()};return{init:r}}(),AnswerFooterController=function(n){var t=function(t,i,r){t.html("");t.next(".comment-loading").removeClass("hide");var u=function(n){t.html(n);t.next(".comment-loading").addClass("hide")};n.getComments(u,i,r)},u=function(){var n=$(this),r=n.attr("data-page-number"),i=n.closest(".comment-list"),u=i.closest(".answer-comment"),f=u.attr("data-answer-id");t(i,f,+r)},i=function(n){return n>0?`${n} Comment(s)`:"Add Comment"},f=function(){var u=$(this).parent(".answer-footer-bar"),r=u.find(".comment-button-text"),n=u.next(".answer-comment"),f,e,o;n.hasClass("hide")?(f=n.attr("data-answer-id"),e=n.find(".comment-list"),t(e,f,1),n.removeClass("hide"),r.html("Hide Comment")):(n.addClass("hide"),o=r.attr("data-total-count"),r.html(i(o)))},e=function(n){var f=n.find(".comment-header strong"),r=n.closest(".answer-footer").find(".comment-button-text"),t=r.attr("data-total-count"),u;t=+t+1;r.attr("data-total-count",t);u=i(t);f.html(u);r.html(u)},o=function(){var i=$(this),r=i.attr("data-answer-id"),u=i.prev(),f=u.val().trim(),o;f&&(o=function(n){u.val("");var f=i.closest(".comment-container"),o=f.find(".comment-list");e(f);t(o,r,n)},n.postComment(o,r,f))},r=function(n,t){return n>0?t?`Liked ${n}`:`Like ${n}`:"Like"},s=function(){var t=$(this),s=t.parent(".answer-footer-bar"),u=s.attr("data-answer-id"),i=t.attr("data-like-count"),f=t.find(".like-button-text"),e,o;t.hasClass("answer-liked")?(e=function(){t.removeClass("answer-liked");i=+i-1;f.html(r(i,!1));t.attr("data-like-count",i)},n.unlikeAnswer(e,u)):(o=function(){t.addClass("answer-liked");i=+i+1;f.html(r(i,!0));t.attr("data-like-count",i)},n.likeAnswer(o,u))},h=function(){var n=$(".question-answer-container, .activity-whole-panel");n.on("click",".answer-footer-bar .comment-button",f);n.on("input",".answer-comment textarea",appController.textareaAutoGrow);n.on("click",".answer-comment .write-comment .btn",o);n.on("click",".answer-comment .comment-pagination-container .comment-page",u);n.on("click",".answer-footer-bar .like-button",s)};return{init:h}}(AnswerFooterService),HeaderController=function(n,t){var i=function(){var t=$(".modal-container");if(iknow.isUserAuthorized!==!0){WarningErrorController.showWarning("Please log in before you add question");return}if(t.hasClass("new-question-form-loaded")){ModalController.open();return}n.getForm(function(n){ModalController.toggleModalCommonCallback(n);t.addClass("new-question-form-loaded")})},r=function(){event.stopPropagation();$(".user-profile-dropdown").show()},u=function(n){var i=$(".search").val();if(i===""||n.keyCode===27){$(".search-result-container").html("");return}t.search(i,function(n){n&&$(".search-result-container").html(n)})},f=function(n){$(n.target).parents(".search-container").length>0||$(".search-result-container").html("")},e=function(){$(".user-profile-dropdown").hide();f(event)},o=function(){$(".add-question-button").on("click",i);$(".user-profile-inner").on("click",r);$(".search").on("keyup",u);$(document).on("click",e)};return{init:o}}(QuestionService,SearchService),LoadMoreController=function(n){var u,t,f,i,e,r,o=function(n){n?(f.append(n),t.show(),t.next().hide(),i++):t.parent().addClass("end-of-list");r&&r()},s=function(){t=$(this);t.hide();t.next().show();n.loadMore(u,i,o,e)},h=function(n,t,o){u=n;f=$(".load-more-list");i=0;e=t;r=o;$(".to-load").on("click",s)};return{init:h}}(LoadMoreService),ModalController=function(){var t=function(){if(event.target===event.currentTarget){var n=$(".modal-container");if(n.hasClass("open")){n.removeClass("open");$(document.body).removeClass("modal-open");return}}},n=function(){$(".modal-container").addClass("open");$(document.body).addClass("modal-open")},i=function(){$(".modal-container").removeClass("open");$(document.body).removeClass("modal-open")},r=function(t){if(t){var i=$(".modal-container");i.html(t);n();$(".topic-select").chosen({width:"100%",max_selected_options:5})}},u=function(){$(".modal-container").on("click",t);$(".modal-container").on("click",".js-button-delete",appController.deleteEntity);$(".modal-container").on("input","textarea",appController.textareaAutoGrow);$(".modal-container").on("click",".error li",WarningErrorController.hideError)};return{init:u,toggleModalCommonCallback:r,open:n,close:i}}(),PhotoUploadController=function(n,t){var i,r=function(n){var f,o,h,e,s,c,l,u=160,a,y=i.attr("data-user-id");$(".modal-container").removeClass("new-question-form-loaded");var r={},k=function(){e=(f.width-u)/2;s=(f.height-u)/2;c=u+e;l=u+s;r.currentX||(r.currentX=e);r.currentY||(r.currentY=s);r.currentWidth||(r.currentWidth=u);r.currentHeight||(r.currentHeight=u);a=$(".photo-resizer input").val()},d=function(){o.clearRect(0,0,f.width,f.height);o.fillStyle="#f6f6f6";o.fillRect(0,0,f.width,f.height)},g=function(n,t){var c=h.width*a,l=h.height*a,f=r.currentX-(c-r.currentWidth)/2+(n?n:0),i;f>e&&(f=e);f<e-(c-u)&&(f=e-(c-u));i=r.currentY-(l-r.currentHeight)/2+(t?t:0);i>s&&(i=e);i<s-(l-u)&&(i=s-(l-u));o.drawImage(h,f,i,c,l);r.currentX=f;r.currentY=i;r.currentWidth=c;r.currentHeight=l},nt=function(){o.globalAlpha=.5;o.fillRect(e,0,u,s);o.fillRect(0,0,e,f.height);o.fillRect(e,l,u,f.height-l);o.fillRect(c,0,f.width-c,f.height);o.globalAlpha=1},v=function(n,t){k();d();g(n,t);nt()},p=function(n){var t={},i;n.preventDefault();n.stopPropagation();i=n.originalEvent.touches;t.x=(n.clientX||n.pageX||i[0].clientX)+$(window).scrollLeft();t.y=(n.clientY||n.pageY||i[0].clientY)+$(window).scrollTop();v(t.x-r.originalX,t.y-r.originalY);r.originalX=t.x;r.originalY=t.y},w=function(n){n.preventDefault();n.stopPropagation();r.originalX=(n.clientX||n.pageX||touches[0].clientX)+$(window).scrollLeft();r.originalY=(n.clientY||n.pageY||touches[0].clientY)+$(window).scrollTop();$(document).on("mousemove touchmove",p);$(document).on("mouseup touchend",b)},b=function(n){n.preventDefault();$(document).off("mouseup touchend",b);$(document).off("mousemove touchmove",p)},tt=function(n){$("#photo-canvas").off("mousedown touchstart",w);f=$("#photo-canvas")[0];o=f.getContext("2d");h=new Image;h.src=n.currentTarget.result;h.onload=function(){v()};var t=$(".photo-resizer input");t.on("input change",function(){v()});t.val(1);$("#photo-canvas").on("mousedown touchstart",w)},it=function(){var n=document.createElement("canvas"),r;n.width=u;n.height=u;n.getContext("2d").drawImage(f,e,s,u,u,0,0,u,u);r=n.toDataURL("image/png");t.savePhoto(y,r,function(){i.attr("src",r);$(".profile-photo").attr("src",r);ModalController.close()})},rt=function(t){if(n.currentTarget.files&&n.currentTarget.files[0]){ModalController.toggleModalCommonCallback(t);var i=new FileReader;i.onload=tt;i.readAsDataURL(n.currentTarget.files[0]);$(".save-photo").click(it)}};t.getForm(rt,y)},u=function(){$(this).val("")},f=function(n,t){i=$(t);$(n).on("change",r);$(n).on("click",u)};return{init:f}}(QuestionService,PhotoUploadService),QuestionController=function(n){var t,e=function(){var n=$(".ql-editor");return n.text().trim().length===0&&n.find("img").length===0?(WarningErrorController.showWarning("Content can not be empty."),!1):($(".ql-editor").html()&&($(this).get(0).elements.AnswerPanelContent.value=$(".ql-editor").html()),!0)},o=function(){return new Quill(".rich-editor-inner",{placeholder:"Write your answer here...",modules:{toolbar:[["bold","italic"],[{header:2},"blockquote"],[{list:"ordered"},{list:"bullet"}],["link","image"],["clean"]]},theme:"snow",formats:["bold","italic","link","header","list","blockquote","image","indent"],clipboard:{matchVisual:!1},bounds:".rich-editor"})},s=function(n){var t,i;n.currentTarget.scrollHeight!==n.currentTarget.offsetHeight&&(t=0,n.originalEvent.wheelDelta?t=n.originalEvent.wheelDelta:n.originalEvent.detail&&(t=-n.originalEvent.detail),i=$(n.currentTarget).scrollTop(),(t<0&&i>n.currentTarget.scrollHeight-n.currentTarget.offsetHeight-5||t>0&&i<5)&&n.preventDefault())},h=function(){$(".ql-editor").on("mousewheel DOMMouseScroll",function(n){s(n)});$(".full-screen").on("click",function(){$("body").toggleClass("modal-open editor-full-screen")})},c=function(){$("html, body").scrollTop($(".main-content-container").offset().top-100);$(".ql-editor").get(0).focus()},i=function(n){if($(".add-answer-panel").hasClass("hide")){if(iknow.isUserAuthorized!==!0){WarningErrorController.showWarning("Please log in before you write question");return}if(n===!0){var t=$(event.currentTarget).siblings(".answer-panel-content-inner").html();$(".rich-editor-inner").html(t)}o();h();$(".add-answer-panel.hide").slideDown(100).removeClass("hide")}c()},l=function(){var i=$(event.currentTarget).attr("data-question-id"),t;$(".modal-container").removeClass("new-question-form-loaded");t=function(n){ModalController.toggleModalCommonCallback(n);var t=$(".add-question-description textarea"),i=$(".add-question-description textarea").get(0).scrollHeight;t.css("height",i+"px")};n.getForm(t,i)},a=function(){var t=$(event.currentTarget).attr("data-question-id");$(".modal-container").removeClass("new-question-form-loaded");n.getTopic(ModalController.toggleModalCommonCallback,t)},v=function(){var n=$(".load-more-list"),t=n.attr("data-answer-count");n.find(".answer-panel").length===t&&$(".load-more").addClass("end-of-list")},r=function(){event.stopPropagation();var n=$(this).closest(".answer-panel-content-container"),t;n.hasClass("is-collapsed")||(t=n.height()-$(window).scrollTop());n.toggleClass("is-collapsed");t&&$(window).scrollTop(n.height()-t)},u=function(n){var t=n.closest(".answer-panel-content-container");t.outerHeight()<800?t.find(".collapse-answer").addClass("hide"):t.find(".collapse-answer").removeClass("hide")},y=function(n){var t=n.find("img");if(u(n),t.length>0)t.on("load",function(){u(n)})},p=function(){var n;n=t?t.nextAll().find(".answer-panel-content"):$(".whole-panel, .current-answer-panel").find(".answer-panel-content");$.each(n,function(i){y($(this));i===n.length-1&&(t=$(this).closest(".answer-panel"))})},f=function(){v();p()},w=function(){$(".more-answer-panel .answer-panel-content-container").addClass("is-collapsed")},b=function(){$(".add-answer-panel").on("submit","form",e);$(".add-answer-panel").on("click",".js-button-delete",appController.deleteEntity);$(".write-answer").on("click",i);$(".edit-answer").on("click",function(){i(!0)});$(".question-header-panel .js-edit-question").on("click",l);$(".question-header-panel .js-edit-topic").on("click",a);$(".whole-panel, .answer-panel-container").on("click",".collapse-answer",r);$(".whole-panel, .answer-panel-container").on("click",".answer-panel-content-container.is-collapsed",r);AnswerFooterController.init();f()};return{init:b,loadAnswerCallBack:f,collapseAnswersInMoreAnswersPanel:w}}(QuestionService),RegisterController=function(n){var t=function(){if($(".modal-container").hasClass("register-form-loaded")){ModalController.open();return}var t=$(event.currentTarget).attr("data-return-url")?"?returnUrl="+$(event.currentTarget).attr("data-return-url"):"";n.getRegisterForm(function(n){ModalController.toggleModalCommonCallback(n);$(".modal-container").addClass("register-form-loaded")},t)},i=function(){$(".register-container a").on("click",t)};return{init:i}}(RegisterService),TopicController=function(n){var t,u=function(){var t=$(this),i;t.hasClass("active")||(i=t.attr("data-topic-id"),n.selectTopic(i,function(n){n&&(t.siblings().removeClass("active"),t.addClass("active"),$(".topic-body").html(n))}))},f=function(){t=$(this);var u=t.attr("data-topic-id");t.hasClass("btn-grey")?n.unfollow(u,i,r):n.follow(u,i,r)},i=function(){var n=t.hasClass("btn-grey")?"Follow":"Following";t.toggleClass("btn-grey").text(n)},r=function(){var n=t.hasClass("btn-grey")?"unfollow":"follow";console.error("Something went wrong with TopicService "+n+".")},e=function(){$(".topic-list").on("click","li",u);$(".js-topic-toggle").on("click",f)};return{init:e}}(TopicService),TopicPhotoUploadController=function(){var n,t=function(){if(event.currentTarget.files&&event.currentTarget.files[0]){var t=new FileReader;t.onload=function(t){n.attr("src",t.currentTarget.result)};t.readAsDataURL(event.currentTarget.files[0])}},i=function(i,r){n=$(r);$(i).on("change",t)};return{init:i}}(),WarningErrorController=function(){var n=function(){$(this).hide()},i=function(){$(".warning").removeClass("warning-display severe-warning");$(".error").removeClass("validation-summary-errors")},t=function(n,t){var r=$(".warning");i();r.html("");$("<div>").html(n).appendTo(r);t&&r.addClass("severe-warning");setTimeout(function(){r.addClass("warning-display")},50)},r=function(){iknow.pageError&&t(iknow.pageError,!0);iknow.statusMessage&&t(iknow.statusMessage)},u=function(){$(".error").on("click","li",n);$(".warning").on("click","div",n);r()};return{init:u,hideError:n,showWarning:t,cleanUpErrorAndWarning:i}}(),AnswerFooterService=function(){var n=function(n,t,i){$.ajax({url:"/question/getcomments/"+t+"/"+i,dataType:"html",success:n,fail:function(){console.error("Something went wrong with AnswerFooterService getComments.")}})},t=function(n,t,i){$.ajax({url:"/answerFooter/postComment",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({answerId:t,comment:i}),success:n,fail:function(){console.error("Something went wrong with AnswerFooterService postComment.")}})},i=function(n,t){$.ajax({url:"/answerFooter/likeAnswer/"+t,type:"POST",contentType:"application/json; charset=utf-8",success:n,fail:function(){console.error("Something went wrong with AnswerFooterService likeAnswer.")}})},r=function(n,t){$.ajax({url:"/answerFooter/unlikeAnswer/"+t,type:"DELETE",contentType:"application/json; charset=utf-8",success:n,fail:function(){console.error("Something went wrong with AnswerFooterService unlikeAnswer.")}})};return{getComments:n,postComment:t,likeAnswer:i,unlikeAnswer:r}}(),LoadMoreService=function(){var n=function(n,t,i,r){$.ajax({url:"/"+n+"/loadmore/"+t+(r?r:""),dataType:"html",success:i,fail:function(){console.error("Something went wrong with LoadMoreService loadMore.")}})};return{loadMore:n}}(),PhotoUploadService=function(){var n=function(n,t){$.ajax({url:"/account/editProfilePhoto/"+t,dataType:"html",success:n,fail:function(){console.error("Something went wrong with PhotoUploadService getForm.")}})},t=function(n,t,i){$.ajax({url:"/api/account",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify({userId:n,dataURL:t}),success:i,fail:function(){console.error("Something went wrong with PhotoUploadService savePhoto.")}})};return{getForm:n,savePhoto:t}}(),QuestionService=function(){var n=function(n,t){$.ajax({url:"/question/getform"+(t?"/"+t:""),dataType:"html",success:n,fail:function(){console.error("Something went wrong with QuestionService getForm.")}})},t=function(n,t){$.ajax({url:"/question/gettopic/"+t,dataType:"html",success:n,fail:function(){console.error("Something went wrong with QuestionService getForm.")}})};return{getForm:n,getTopic:t}}(),RegisterService=function(){var n=function(n,t){$.ajax({url:"/account/register"+t,dataType:"html",success:n,fail:function(){console.error("Something went wrong with RegisterService getRegisterForm.")}})};return{getRegisterForm:n}}(),SearchService=function(){var n=function(n,t){$.ajax({url:"/search/getresult?input="+n,dataType:"html",success:t,fail:function(){console.error("Something went wrong with SearchService search.")}})};return{search:n}}(),TopicService=function(){var n=function(n,t){$.ajax({url:"/topic/about/"+n,dataType:"html",success:t,fail:function(){console.error("Something went wrong with TopicService selectTopic.")}})},t=function(n,t,i){$.post("/api/topicfollowing",{"":n}).done(t).fail(i)},i=function(n,t,i){$.ajax({url:"/api/topicfollowing/"+n,method:"DELETE"}).done(t).fail(i)};return{selectTopic:n,follow:t,unfollow:i}}();